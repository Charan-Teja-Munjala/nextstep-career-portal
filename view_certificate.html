<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate of Completion - NextStep Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Merriweather', serif;
            -webkit-print-color-adjust: exact;
        }
        .certificate-body {
            width: 1100px;
            height: 850px;
            background-color: #fcfcf8; /* Lighter Parchment */
            position: relative;
            border: 1px solid #c0a062;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .certificate-border {
            position: absolute;
            top: 25px; left: 25px; right: 25px; bottom: 25px;
            border: 1.5px solid #b48811;
            padding: 10px;
            background:
                linear-gradient(45deg, #c0a062 25%, transparent 25%, transparent 75%, #c0a062 75%),
                linear-gradient(45deg, #c0a062 25%, transparent 25%, transparent 75%, #c0a062 75%) 0 0,
                linear-gradient(to bottom, #0d244f, #0d244f) 0 0 / 100% 2px,
                linear-gradient(to bottom, #0d244f, #0d244f) 0 100% / 100% 2px,
                linear-gradient(to right, #0d244f, #0d244f) 0 0 / 2px 100%,
                linear-gradient(to right, #0d244f, #0d244f) 100% 0 / 2px 100%;
            background-repeat: no-repeat;
        }
        .certificate-content {
            width: 100%; height: 100%;
            border: 1px solid #c0a062;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 2.5rem;
            text-align: center;
            position: relative;
            background-image: url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cpath d="M11 18.272l-7.272 4.09V44.18l7.272 4.09 7.272-4.09V22.364L11 18.272zm48 0l-7.272 4.09V44.18l7.272 4.09 7.272-4.09V22.364L59 18.272z" fill="%230d244f" fill-opacity="0.04" fill-rule="evenodd"/%3E%3C/svg%3E');
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
        }
        .student-name { font-family: 'Great Vibes', cursive; color: #0d244f; }
        .seal {
            width: 140px;
            height: 140px;
            position: relative;
        }
        .seal-ribbon {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 100px;
            background: linear-gradient(to bottom right, #990000, #D10000);
            clip-path: polygon(0 0, 100% 0, 80% 100%, 20% 100%);
            z-index: 1;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .seal-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, #f0e68c 0%, #daa520 80%, #b8860b 100%);
            position: absolute;
            top: 0;
            left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            border: 4px solid #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
         @media print {
            body, html { margin: 0; padding: 0; width: 1100px; height: 850px; }
            .no-print { display: none; }
            .certificate-wrapper { box-shadow: none; border: none; }
        }
    </style>
</head>
<body class="bg-gray-200 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="certificate-wrapper" class="bg-white p-2 shadow-2xl rounded-sm">
        <div id="certificate-body" class="certificate-body">
            <div class="certificate-border">
                <div id="certificate-content" class="certificate-content">
                    <!-- Content will be loaded here -->
                    <p id="loading-message" class="text-xl text-gray-700">Loading Certificate...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-8 text-center no-print">
        <button onclick="window.print()" class="bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2">
            <i data-lucide="printer" class="w-5 h-5"></i>
            Print or Save as PDF
        </button>
    </div>

    <script>
        lucide.createIcons();
        document.addEventListener('DOMContentLoaded', () => {
            const certificateContent = document.getElementById('certificate-content');
            const loadingMessage = document.getElementById('loading-message');
            const urlParams = new URLSearchParams(window.location.search);
            const uid = urlParams.get('uid');

            if (!uid) {
                loadingMessage.textContent = 'Error: No Certificate ID provided.';
                loadingMessage.classList.add('text-red-500');
                return;
            }

            fetch(`api/certificate_handler.php?uid=${uid}`)
                .then(response => {
                    if (!response.ok) { throw new Error('Certificate not found or server error.'); }
                    return response.json();
                })
                .then(data => {
                    if (data.error) { throw new Error(data.error); }
                    
                    document.title = `Certificate for ${data.course_title}`;
                    
                    const certificateUrl = window.location.href;
                    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(certificateUrl)}`;

                    certificateContent.innerHTML = `
                        <div class="text-center">
                            <p class="font-bold text-3xl text-indigo-900">NextStep Hub</p>
                            <p class="text-sm text-gray-500 tracking-widest">GLOBAL LEARNING PLATFORM</p>
                        </div>
                        
                        <div class="my-2">
                            <p class="text-gray-600 mt-4 text-2xl tracking-wider">CERTIFICATE OF COMPLETION</p>
                            <p class="text-gray-500 mt-4 text-lg">Be it known that</p>
                            <h1 class="student-name text-8xl font-bold my-1">${data.user_name}</h1>
                            <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                                has successfully fulfilled all the requirements for the course
                            </p>
                            <p class="font-bold text-3xl text-gray-800 mt-2">${data.course_title}</p>
                        </div>
                        
                        <div class="w-full flex justify-between items-end text-sm mt-4">
                            <div class="text-center w-1/3">
                                <p class="font-semibold text-lg border-b-2 border-gray-500 pb-1 px-8 italic">Signature</p>
                                <p class="text-gray-600 mt-1">${data.organization_name}</p>
                            </div>
                             <div class="text-center w-1/3">
                                <div class="seal mx-auto">
                                    <div class="seal-ribbon"></div>
                                    <div class="seal-circle">
                                        <i data-lucide="award" class="w-16 h-16 text-white" stroke-width="1"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center w-1/3 flex flex-col items-center justify-end">
                                <img src="${qrCodeUrl}" alt="Certificate QR Code" class="w-20 h-20 p-1 bg-white border mb-2">
                                <p class="font-semibold text-lg border-b-2 border-gray-500 pb-1 px-8">${data.formatted_issue_date}</p>
                                <p class="text-gray-600 mt-1">Date Issued</p>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2 absolute bottom-4 right-8">Credential ID: ${data.certificate_uid}</p>
                    `;
                    lucide.createIcons();
                })
                .catch(error => {
                    console.error('Error fetching certificate:', error);
                    loadingMessage.textContent = `Error: ${error.message}`;
                    loadingMessage.classList.add('text-red-500');
                });
        });
    </script>
</body>
</html>

